---
description: 当用户发送Github PR链接、要求审查代码、或需要提交代码、发起PR时
alwaysApply: true
---

## 代码审查要点

**最高优先级**：

1. **性能优化**：深度挖掘一切可能的性能提升机会
2. **代码简化**：寻找一切可以简化代码的机会

**标准检查项**：

3. **代码正确性**：实现是否符合预期，边界条件和异常路径是否处理
4. **规范符合性**：代码风格、命名、注释是否符合项目规范
5. **安全与稳定**：线程安全、资源泄漏、返回值检查
6. **接口使用**：调用的接口是否符合其用法意图和最佳实践
7. **接口变更**：公开接口变更需关注必要性和兼容性
8. **测试覆盖**：变更是否有对应测试，边界情况是否覆盖
9. **潜在风险**：是否引入回归风险或影响其他模块
10. **整体设计**：结合关联代码评估修改后的整体合理性，必要时建议扩大修改范围


## 发起 PR 流程

1. 运行 `./codeformat.sh` 格式化代码，忽略输出的报错，只要运行就会完成格式化
2. 按上述代码审查要点自审本地变更
3. 输出以下内容供用户确认：
   - **分支名称**：格式见 Git.md 分支命名规范
   - **PR 标题**：英语，格式见 Git.md Commit 信息要求
   - **PR 描述**：中文简要说明变更内容
4. 确认后创建分支、推送代码、并使用上面的PR标题和PR描述内容执行 `gh pr create`，**禁止再重新写PR描述**

## Review PR 流程

1. 用 `gh` 命令获取 PR 变更和评论，结合本地代码理解上下文
2. 输出变更总结和优化后的 PR 标题
3. 按代码审查要点逐项检查（见下方审查清单）
4. 验证已有评论是否真正修复（重点关注用户提过的评论）
5. 深度复核：对发现的每个问题进行二次验证，确认是否真正存在问题（排除误报、已处理、或理解偏差的情况）
6. 输出最终问题列表，按序号汇总真正存在的问题，经用户确认后添加中文行级评论

### 行级评论格式

- **禁止使用 `gh pr comment`、`gh pr review --comment`、`gh pr review --body` 或任何非行级评论命令**
- 使用 `gh api` 配合 `--input -` 和 heredoc 传递 JSON
```bash
gh api repos/{owner}/{repo}/pulls/{pr}/reviews --input - <<'EOF'
{"commit_id":"HEAD_SHA","event":"COMMENT","comments":[{"path":"文件路径","line":行号,"side":"RIGHT","body":"内容"}]}
EOF
```
